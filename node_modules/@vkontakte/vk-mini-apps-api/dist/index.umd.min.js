!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).vkMiniAppsAPI={})}(this,function(e){"use strict";var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t])})(e,n)};var i=function(){return(i=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)};function a(i,s,c,u){return new(c=c||Promise)(function(e,n){function t(e){try{o(u.next(e))}catch(e){n(e)}}function r(e){try{o(u.throw(e))}catch(e){n(e)}}function o(n){n.done?e(n.value):new c(function(e){e(n.value)}).then(t,r)}o((u=u.apply(i,s||[])).next())})}function p(t,r){var o,i,s,e,c={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(n){return function(e){return function(n){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,i&&(s=2&n[0]?i.return:n[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,n[1])).done)return s;switch(i=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(!(s=0<(s=c.trys).length&&s[s.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){c.label=n[1];break}if(6===n[0]&&c.label<s[1]){c.label=s[1],s=n;break}if(s&&c.label<s[2]){c.label=s[2],c.ops.push(n);break}s[2]&&c.ops.pop(),c.trys.pop();continue}n=r.call(t,c)}catch(e){n=[6,e],i=0}finally{o=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,e])}}}var s=function(){return(s=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)};function c(e,n){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(t[r[o]]=e[r[o]])}return t}var n=["VKWebAppInit","VKWebAppGetCommunityAuthToken","VKWebAppAddToCommunity","VKWebAppGetUserInfo","VKWebAppSetLocation","VKWebAppGetClientVersion","VKWebAppGetPhoneNumber","VKWebAppGetEmail","VKWebAppGetGeodata","VKWebAppSetTitle","VKWebAppGetAuthToken","VKWebAppCallAPIMethod","VKWebAppJoinGroup","VKWebAppAllowMessagesFromGroup","VKWebAppDenyNotifications","VKWebAppAllowNotifications","VKWebAppOpenPayForm","VKWebAppOpenApp","VKWebAppShare","VKWebAppShowWallPostBox","VKWebAppScroll","VKWebAppResizeWindow","VKWebAppShowOrderBox","VKWebAppShowLeaderBoardBox","VKWebAppShowInviteBox","VKWebAppShowRequestBox","VKWebAppAddToFavorites"],u=[],d=null,r="undefined"!=typeof window,o=r&&window.webkit&&void 0!==window.webkit.messageHandlers&&void 0!==window.webkit.messageHandlers.VKWebAppClose,l=r?window.AndroidBridge:void 0,f=o?window.webkit.messageHandlers:void 0,h=r&&!l&&!f,b=h?"message":"VKWebAppEvent";function v(e,n){var t=n||{bubbles:!1,cancelable:!1,detail:void 0},r=document.createEvent("CustomEvent");return r.initCustomEvent(e,!!t.bubbles,!!t.cancelable,t.detail),r}r&&(window.CustomEvent||(window.CustomEvent=(v.prototype=Event.prototype,v)),window.addEventListener(b,function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var t=function(){for(var e=0,n=0,t=arguments.length;n<t;n++)e+=arguments[n].length;var r=Array(e),o=0;for(n=0;n<t;n++)for(var i=arguments[n],s=0,c=i.length;s<c;s++,o++)r[o]=i[s];return r}(u);if(h&&n[0]&&"data"in n[0]){var r=n[0].data,o=(r.webFrameId,r.connectVersion,c(r,["webFrameId","connectVersion"]));o.type&&"VKWebAppSettings"===o.type?d=o.frameId:t.forEach(function(e){e({detail:o})})}else t.forEach(function(e){e.apply(null,n)})}));function m(e,n){void 0===n&&(n={}),l&&"function"==typeof l[e]&&l[e](JSON.stringify(n)),f&&f[e]&&"function"==typeof f[e].postMessage&&f[e].postMessage(n),h&&parent.postMessage({handler:e,params:n,type:"vk-connect",webFrameId:d,connectVersion:"1.6.9"},"*")}function y(e){u.push(e)}var w,A,V,W={send:m,subscribe:y,sendPromise:(w=m,A=y,V=function(){var t={current:0,next:function(){return this.current+=1,this.current}},o={};return{add:function(e){var n=t.next();return o[n]=e,n},resolve:function(e,n,t){var r=o[e];r&&(t(n)?r.resolve(n):r.reject(n),o[e]=null)}}}(),A(function(e){if(e.detail&&e.detail.data){var n=e.detail.data,t=n.request_id,r=c(n,["request_id"]);t&&V.resolve(t,r,function(e){return!("error_type"in e)})}}),function(r,o){return new Promise(function(e,n){var t=V.add({resolve:e,reject:n});w(r,s(s({},o),{request_id:t}))})}),unsubscribe:function(e){var n=u.indexOf(e);-1<n&&u.splice(n,1)},isWebView:function(){return!(!l&&!f)},supports:function(e){return!(!l||"function"!=typeof l[e])||(!(!f||!f[e]||"function"!=typeof f[e].postMessage)||!(f||l||!n.includes(e)))}};if("object"!=typeof e||"undefined"==typeof module){var K=null;"undefined"!=typeof window?K=window:"undefined"!=typeof global?K=global:"undefined"!=typeof self&&(K=self),K&&(K.vkConnect=W,K.vkuiConnect=W)}var g=(P.prototype.subscribeEvent=function(n,t){function e(e){e.detail&&e.detail.data&&0===e.detail.type.indexOf(n)&&!e.detail.type.includes("Failed")&&t(e.detail.data)}var r=this;return this.connect.subscribe(e),function(){return r.connect.unsubscribe(e)}},P);function P(e){this.connect=e||W}var _,k,C,O=(t(_=G,k=C=g),void(_.prototype=null===k?Object.create(k):(S.prototype=k.prototype,new S)),G.prototype.initApp=function(){this.connect.send("VKWebAppInit",{})},G);function S(){this.constructor=_}function G(){var u=null!==C&&C.apply(this,arguments)||this;return u.onUpdateConfig=function(e){return u.subscribeEvent("VKWebAppUpdateConfig",e)},u.onViewHide=function(e){return u.subscribeEvent("VKWebAppViewHide",e)},u.onViewRestore=function(e){return u.subscribeEvent("VKWebAppViewRestore",e)},u.denyNotifications=function(){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppDenyNotifications")];case 1:return e.sent(),[2]}})})},u.callAPIMethod=function(n,t){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppCallAPIMethod",{method:n,params:t})];case 1:return[2,e.sent().response]}})})},u.closeApp=function(n,t){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppClose",{status:n,payload:t})];case 1:return e.sent(),[2]}})})},u.getAuthToken=function(r,o){return a(u,void 0,void 0,function(){var n,t;return p(this,function(e){switch(e.label){case 0:return n=Array.isArray(o)?o.join(","):"",[4,this.connect.sendPromise("VKWebAppGetAuthToken",{app_id:r,scope:n})];case 1:return[2,{accessToken:(t=e.sent()).access_token,scope:t.scope.split(",")}]}})})},u.getClientVersion=function(){return a(u,void 0,void 0,function(){return p(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetClientVersion")]})})},u.openApp=function(n,t){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppOpenApp",{app_id:n,location:t})];case 1:return e.sent(),[2]}})})},u.getEmail=function(){return a(u,void 0,void 0,function(){return p(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetEmail")]})})},u.getFriends=function(n){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppGetFriends",{multi:n})];case 1:return[2,e.sent().users]}})})},u.getGeodata=function(){return a(u,void 0,void 0,function(){var n;return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppGetGeodata")];case 1:return[2,{isAvailable:!!(n=e.sent()).available,lat:parseFloat(n.lat),long:parseFloat(n.long)}]}})})},u.getPersonalCard=function(n){return a(u,void 0,void 0,function(){return p(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetPersonalCard",{type:n})]})})},u.getPhoneNumber=function(){return a(u,void 0,void 0,function(){var n;return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppGetPhoneNumber")];case 1:return[2,{phone:(n=e.sent()).phone_number,sign:n.sign}]}})})},u.getUserInfo=function(){return a(u,void 0,void 0,function(){return p(this,function(e){return[2,this.connect.sendPromise("VKWebAppGetUserInfo")]})})},u.openCodeReader=function(){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppOpenCodeReader")];case 1:return[2,e.sent().code_data]}})})},u.openContacts=function(){return a(u,void 0,void 0,function(){var n;return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppOpenContacts")];case 1:return[2,{phone:(n=e.sent()).phone,firstName:n.first_name,lastName:n.last_name}]}})})},u.shareLink=function(n){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShare",{link:n})];case 1:return[2,e.sent()]}})})},u.showImages=function(n,t){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowImages",{images:n,start_index:t})];case 1:return e.sent(),[2]}})})},u.addToFavorites=function(){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAddToFavorites")];case 1:return e.sent(),[2]}})})},u.postToWall=function(t,r,o){return a(u,void 0,void 0,function(){var n;return p(this,function(e){switch(e.label){case 0:return n=i({message:t,attachments:Array.isArray(r)?function(e){return e.map(function(e){return"string"==typeof e?e:e.type+e.ownerId+"_"+e.mediaId}).join(",")}(r):r},o&&{owner_id:o.ownerId,signed:o.isSigned,place_id:o.placeId,lat:o.lat,long:o.long}),[4,this.connect.sendPromise("VKWebAppShowWallPostBox",n)];case 1:return[2,e.sent().post_id]}})})},u.allowNotifications=function(){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAllowNotifications")];case 1:return e.sent(),[2]}})})},u.addAppToCommunity=function(){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAddToCommunity")];case 1:return[2,e.sent().group_id]}})})},u.allowCommunityMessages=function(n,t){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppAllowMessagesFromGroup",{group_id:n,key:t})];case 1:return e.sent(),[2]}})})},u.getCommunityToken=function(o,i,s){return a(u,void 0,void 0,function(){var n,t,r=this;return p(this,function(e){switch(e.label){case 0:if(n=Array.isArray(s)?s.join(","):"",null==(t=["VKWebAppCommunityAccessToken","VKWebAppCommunityToken","VKWebAppGetCommunityAuthToken","VKWebAppGetCommunityToken"].filter(function(e){return r.connect.supports(e)})[0]))throw new Error("Couldn't find available method to get community token");return[4,this.connect.sendPromise(t,{app_id:i,group_id:o,scope:n})];case 1:return[2,{accessToken:e.sent().access_token}]}})})},u.joinCommunity=function(n){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppJoinGroup",{group_id:n})];case 1:return e.sent(),[2]}})})},u.sendPayloadToCommunity=function(n,t){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppSendPayload",{group_id:n,payload:t})];case 1:return e.sent(),[2]}})})},u.showCommunityWidgetPreviewBox=function(n,t,r){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowCommunityWidgetPreviewBox",{type:t,group_id:n,code:r})];case 1:return e.sent(),[2]}})})},u.resizeWindow=function(n,t){return a(u,void 0,void 0,function(){return p(this,function(e){return[2,this.connect.sendPromise("VKWebAppResizeWindow",{width:n,height:t})]})})},u.scrollTo=function(n,t){return void 0===t&&(t=0),a(u,void 0,void 0,function(){return p(this,function(e){return[2,this.connect.sendPromise("VKWebAppScroll",{top:n,speed:t})]})})},u.setLocationHash=function(n){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppSetLocation",{location:n})];case 1:return e.sent(),[2]}})})},u.setViewSettings=function(n,t){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppSetViewSettings",{status_bar_style:n,action_bar_color:t})];case 1:return e.sent(),[2]}})})},u.payToUser=function(r,o,i,s){return a(u,void 0,void 0,function(){var n,t;return p(this,function(e){switch(e.label){case 0:return n={action:"pay-to-user",app_id:i,params:{amount:r,user_id:o,description:s}},[4,this.connect.sendPromise("VKWebAppOpenPayForm",n)];case 1:return[2,"result"in(t=e.sent())?t.result:t]}})})},u.payToCommunity=function(r,o,i,s,c){return a(u,void 0,void 0,function(){var n,t;return p(this,function(e){switch(e.label){case 0:return n={action:"pay-to-group",app_id:i,params:{amount:r,group_id:o,description:s,data:c}},[4,this.connect.sendPromise("VKWebAppOpenPayForm",n)];case 1:return[2,"result"in(t=e.sent())?t.result:t]}})})},u.transferToUser=function(r,o){return a(u,void 0,void 0,function(){var n,t;return p(this,function(e){switch(e.label){case 0:return n={action:"transfer-to-user",app_id:o,params:{user_id:r}},[4,this.connect.sendPromise("VKWebAppOpenPayForm",n)];case 1:return[2,"result"in(t=e.sent())?t.result:t]}})})},u.transferToCommunity=function(r,o){return a(u,void 0,void 0,function(){var n,t;return p(this,function(e){switch(e.label){case 0:return n={action:"transfer-to-group",app_id:o,params:{group_id:r}},[4,this.connect.sendPromise("VKWebAppOpenPayForm",n)];case 1:return[2,"result"in(t=e.sent())?t.result:t]}})})},u.flashGetInfo=function(){return a(u,void 0,void 0,function(){var n;return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppFlashGetInfo",{})];case 1:return[2,{isAvailable:(n=e.sent()).is_available,level:n.level}]}})})},u.flashSetLevel=function(n){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppFlashSetLevel",{level:n})];case 1:return e.sent(),[2]}})})},u.showInviteBox=function(){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowInviteBox")];case 1:return e.sent(),[2]}})})},u.showLeaderBoardBox=function(n){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowLeaderBoardBox",{user_result:n})];case 1:return e.sent(),[2]}})})},u.showOrderBox=function(n){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppShowOrderBox",{type:"item",item:n})];case 1:return[2,e.sent().status]}})})},u.showRequestBox=function(n,t,r){return a(u,void 0,void 0,function(){return p(this,function(e){return[2,this.connect.sendPromise("VKWebAppShowRequestBox",{uid:n,message:t,requestKey:r})]})})},u.storageGet=function(t){return a(u,void 0,void 0,function(){var n;return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageGet",{keys:[t]})];case 1:return(n=e.sent())&&Array.isArray(n.keys)&&0!==n.keys.length?[2,n.keys[0].value]:[2,""]}})})},u.storageGetMultiple=function(t){return a(u,void 0,void 0,function(){var n;return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageGet",{keys:t})];case 1:return[2,(n=e.sent())&&Array.isArray(n.keys)&&0<n.keys.length?n.keys.reduce(function(e,n){var t;return i(i({},e),((t={})[n.key]=n.value,t))},{}):{}]}})})},u.storageGetKeys=function(t,r){return void 0===r&&(r=0),a(u,void 0,void 0,function(){var n;return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageGetKeys",{count:t,offset:r})];case 1:return[2,(n=e.sent())&&n.keys||[]]}})})},u.storageSet=function(n,t){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppStorageSet",{key:n,value:t})];case 1:return e.sent(),[2]}})})},u.impactOccurred=function(n){return void 0===n&&(n="medium"),a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppTapticImpactOccurred",{style:n})];case 1:return e.sent(),[2]}})})},u.notificationOccurred=function(n){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppTapticNotificationOccurred",{type:n})];case 1:return e.sent(),[2]}})})},u.selectionChanged=function(){return a(u,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return[4,this.connect.sendPromise("VKWebAppTapticSelectionChanged")];case 1:return e.sent(),[2]}})})},u}e.VKMiniAppAPI=O,Object.defineProperty(e,"__esModule",{value:!0})});
